/* This file is managed by Puppet. Any changes will be overridden. */
options {
        directory "<%= @run_path %>";

        auth-nxdomain no;

        dnssec-enable <%= @dnssec_enable %>;
        dnssec-validation <%= @dnssec_validation %>;
        dnssec-lookaside <%= @dnssec_lookaside %>;

        bindkeys-file "<%= @bind_keys_file %>";
        managed-keys-directory "<%= @managed_keys_path %>";

        check-names master <%= @check_names_master %>;
        check-names slave <%= @check_names_slave %>;
        check-names response <%= @check_names_response %>;

    <%- if @listen_ipv4 -%>
        listen-on port 53 { <%= scope.function_coalesce_array([ @listen_ipv4, '127.0.0.1' ]) %> };
    <%- end -%>
    <%- if @listen_ipv6 -%>
        listen-on-v6 port 53 { <%= scope.function_coalesce_array([ @listen_ipv6, '::1' ]) %> };
    <%- end -%>
    <%- if @forward_policy and @forwarders -%>
        forward <%= @forward_policy %>;
        forwarders { <%= scope.function_coalesce_array([ @forwarders ]) %> };
    <%- end -%>
    <%- if @allow_update -%>
        allow-update { <%= scope.function_coalesce_array([ @allow_update, 'none' ]) %> };
    <%- end -%>
    <%- if @allow_transfer -%>
        allow-transfer { <%= scope.function_coalesce_array([ @allow_transfer, 'none' ]) %> };
    <%- end -%>
    <%- if @allow_notify -%>
        allow-notify { <%= scope.function_coalesce_array([ @allow_notify, 'none' ]) %> };
    <%- end -%>
    <%- if @allow_recursion -%>
        allow-recursion { <%= scope.function_coalesce_array([ @allow_recursion, 'none' ]) %> };
    <%- end -%>
    <%- if @allow_query -%>
        allow-query { <%= scope.function_coalesce_array([ @allow_query, 'none' ]) %> };
    <%- end -%>
};

controls {
    inet 127.0.0.1 port 953 allow { 127.0.0.1; } keys { "<%= @rndc_key_name %>"; };
};

